<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Certificate Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js"
      async
    ></script>
  </head>
  <body class="min-h-screen bg-slate-950 flex items-center justify-center px-4">
    <div class="max-w-4xl w-full bg-slate-900/80 border border-slate-800 rounded-2xl shadow-2xl p-6 sm:p-8 space-y-6">
      <header class="space-y-2 text-center">
        <h1 class="text-3xl font-semibold tracking-tight text-slate-50">
          Upload your certificate
        </h1>
        <p class="text-sm text-slate-400 max-w-2xl mx-auto">
          Use the paperclip button in the chat below to upload a PDF or image of your certificate.
          Your file will be sent directly to your OpenAI Agent Builder workflow and processed there.
        </p>
      </header>

      <div
        id="chatkit-container"
        class="h-[550px] w-full rounded-2xl border border-slate-800 bg-slate-950/60 overflow-hidden"
      ></div>

      <p class="text-[11px] text-center text-slate-500">
        The chat above is powered by your Agent Builder workflow. Files attached in the chat are
        securely uploaded to OpenAI and processed by your agent.
      </p>
    </div>

    <script>
      function mountChatKit() {
        const container = document.getElementById("chatkit-container");
        if (!container || !customElements.get("openai-chatkit")) return;

        const widget = document.createElement("openai-chatkit");
        widget.style.height = "100%";
        widget.style.width = "100%";

        widget.setOptions({
          theme: "dark",
          api: {
            async getClientSecret(existing) {
              if (existing) {
                return existing;
              }

              const res = await fetch("/api/chatkit/session/", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
              });

              const data = await res.json();
              if (!res.ok || !data.client_secret) {
                throw new Error(
                  data.error || "Failed to create ChatKit session."
                );
              }

              return data.client_secret;
            },
          },
        });

        container.innerHTML = "";
        container.appendChild(widget);
      }

      function initChatKitWhenReady() {
        if (customElements.get("openai-chatkit")) {
          mountChatKit();
          return;
        }

        const interval = setInterval(() => {
          if (customElements.get("openai-chatkit")) {
            clearInterval(interval);
            mountChatKit();
          }
        }, 100);
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initChatKitWhenReady);
      } else {
        initChatKitWhenReady();
      }
    </script>
  </body>
</html>


